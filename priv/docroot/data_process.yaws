<html><head><title>Test for "Deals with security" - Data process</title></head>
<body>

<div><h1>Input data:</h1></div>

<erl>

out(A) ->

	case postvar(A, "merge_test_data") of
		{ok, _} -> security_server:merge_test_data();
		_ -> do_nothing
	end,

	{ok, DTMethod} = postvar(A, "datetime_method"),
	
	{ok, SecurityName}   = postvar(A, "security"),
	SN = list_to_atom(SecurityName),
	
	DateTime = case DTMethod of
				"local_datetime" -> erlang:localtime();
				_ ->
					{ok, Day} = postvar(A, "transaction_day"),
					{ok, Month} = postvar(A, "transaction_month"),
					{ok, Year} = postvar(A, "transaction_year"),
					{ok, Hour} = postvar(A, "transaction_hour"),
					{ok, Minute} = postvar(A, "transaction_minute"),
					{ok, Second} = postvar(A, "transaction_second"),
					Y  = list_to_integer(Year),
					M  = list_to_integer(Month),
					D  = list_to_integer(Day),
					H  = list_to_integer(Hour),
					MM = list_to_integer(Minute),
					S  = list_to_integer(Second),
					{{Y,M,D}, {H,MM,S}}
				end,

	{ok, Price}  = postvar(A, "price"),
	{ok, Amount} = postvar(A, "amount"),

	P  = case string:to_float(Price) of
			{error, _} -> list_to_integer(Price) / 1.0;
			{N, _} -> N
		 end,
	Am = case string:to_float(Amount) of
			{error, _} -> list_to_integer(Amount) / 1.0;
			{N2, _} -> N2
		 end,

	SecData  = {SN, P, Am},
	security_server:add_transaction({DateTime, SecData}),

	Result = "Added.",

	{ehtml, {p, [], Result}}.

</erl>


<p><a href="./data_input.yaws">Input data</a></p>
<p><a href="./data_output.yaws">View data</a></p>
<p><a href="./data_test.yaws">Security server tests</a></p>
<p><a href="./index.yaws">Home page</a></p>

</body>
</html>
